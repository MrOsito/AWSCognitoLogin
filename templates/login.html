<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cognito Dual Login</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1487.0.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .form-container { margin-bottom: 30px; border: 1px solid #ccc; padding: 20px; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    #results { margin-top: 30px; }
  </style>
</head>
<body>
  <h1>AWS Cognito Dual Login</h1>

  <div class="form-container">
    <h2>Login via JavaScript SDK (USER_PASSWORD_AUTH)</h2>
    <form id="jsLoginForm">
      <input type="text" id="jsUsername" placeholder="Username" required>
      <input type="password" id="jsPassword" placeholder="Password" required>
      <button type="submit">Login (JS)</button>
    </form>
  </div>

  <div class="form-container">
    <h2>Login via Flask + boto3</h2>
    <form id="flaskLoginForm">
      <input type="text" id="flaskUsername" placeholder="Username" required>
      <input type="password" id="flaskPassword" placeholder="Password" required>
      <button type="submit">Login (Flask)</button>
    </form>
  </div>

  <div id="results">
    <h3>Results</h3>
    <div id="jsResult"></div>
    <div id="flaskResult"></div>
  </div>

  <script>
    const region = 'ap-southeast-2';
    const clientId = '6v98tbc09aqfvh52fml3usas3c'; // Your App Client ID

    AWS.config.region = region;

    document.getElementById("jsLoginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const start = performance.now();
      const username = document.getElementById("jsUsername").value;
      const password = document.getElementById("jsPassword").value;

      const cognito = new AWS.CognitoIdentityServiceProvider();
      const params = {
        AuthFlow: 'USER_PASSWORD_AUTH',
        ClientId: clientId,
        AuthParameters: {
          USERNAME: username,
          PASSWORD: password
        }
      };

      try {
        const response = await cognito.initiateAuth(params).promise();
        const duration = (performance.now() - start).toFixed(2);
        document.getElementById("jsResult").innerHTML = `
          <strong>JavaScript SDK Login Success (Time: ${duration} ms)</strong><br>
          <pre>${response.AuthenticationResult.IdToken}</pre>`;
      } catch (err) {
        const duration = (performance.now() - start).toFixed(2);
        document.getElementById("jsResult").innerHTML = `<strong>JS Login Failed (${duration} ms):</strong> ${err.message}`;
      }
    });

    document.getElementById("flaskLoginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const start = performance.now();
      const username = document.getElementById("flaskUsername").value;
      const password = document.getElementById("flaskPassword").value;

      try {
        const res = await fetch("/flask-login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        const duration = (performance.now() - start).toFixed(2);

        if (res.ok) {
          document.getElementById("flaskResult").innerHTML = `
            <strong>Flask Login Success (Time: ${duration} ms)</strong><br>
            <pre>${data.id_token}</pre>`;
        } else {
          document.getElementById("flaskResult").innerHTML = `<strong>Flask Login Failed (${duration} ms):</strong> ${data.error}`;
        }
      } catch (err) {
        const duration = (performance.now() - start).toFixed(2);
        document.getElementById("flaskResult").innerHTML = `<strong>Flask Login Error (${duration} ms):</strong> ${err.message}`;
      }
    });
  </script>
</body>
</html>
