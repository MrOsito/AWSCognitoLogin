<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cognito Login</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1487.0.min.js"></script>
  <style>
    #dashboard {
      display: none;
      margin-top: 30px;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h2>Login</h2>
  <form id="loginForm">
    <label for="state">Select your state:</label>
    <select id="state" name="state" required>
      <option value="NSW-">NSW</option>
      <option value="VIC-">VIC</option>
      <option value="QLD-">QLD</option>
      <option value="SA-">SA</option>
      <option value="WA-">WA</option>
      <option value="TAS-">TAS</option>
      <option value="ACT-">ACT</option>
      <option value="NT-">NT</option>
    </select><br><br>

    <label for="membershipNumber">Membership Number:</label>
    <input type="text" id="membershipNumber" name="membershipNumber" required><br><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br><br>

    <button type="submit">Login</button>
  </form>

  <div id="message" style="margin-top: 20px; color: red;"></div>

  <!-- Dashboard section -->
  <div id="dashboard">
    <h3>Welcome! You are logged in.</h3>
    <p><strong>Your ID Token:</strong></p>
    <pre id="idTokenDisplay"></pre>
  </div>

  <script>
    AWS.config.region = 'ap-southeast-2'; // Replace with your region
    const cognitoClientId = 'YOUR_APP_CLIENT_ID'; // Replace with your App Client ID
    const userPoolId = 'ap-southeast-2_XXXXXXX';  // Replace with your User Pool ID

    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const state = document.getElementById("state").value;
      const membershipNumber = document.getElementById("membershipNumber").value;
      const password = document.getElementById("password").value;
      const username = state + membershipNumber;

      const cognito = new AWS.CognitoIdentityServiceProvider();

      const params = {
        AuthFlow: 'USER_PASSWORD_AUTH',
        ClientId: cognitoClientId,
        AuthParameters: {
          USERNAME: username,
          PASSWORD: password
        }
      };

      try {
        const result = await cognito.initiateAuth(params).promise();
        const idToken = result.AuthenticationResult.IdToken;

        // Hide login form
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("message").style.color = "green";
        document.getElementById("message").innerText = "Login successful!";

        // Show dashboard
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("idTokenDisplay").innerText = idToken;

        // Optional: store the token in session/local storage
        // localStorage.setItem("idToken", idToken);
      } catch (err) {
        document.getElementById("message").style.color = "red";
        document.getElementById("message").innerText = "Login failed: " + err.message;
        console.error("Login error:", err);
      }
    });
  </script>
</body>
</html>
